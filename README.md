
# wipac-dev-py-setup-action
GitHub Action Package for Automating Python-Package Setup

Auto-generates `setup.cfg` sections needed for publishing a package to PyPI, `README.md` badges, and `requirements.txt` (by way of [pip-compile](https://github.com/jazzband/pip-tools)).

## Main Configuration Settings

### Generating Metadata for PyPI-Publishing
This will generate sections needed for making a release for your Python package and publishing it to PyPI.

1. You define:
    - `setup.cfg` with the `[wipac:cicd_setup_builder]` section and `[options].install_requires` list, like:
        ```
        [wipac:cicd_setup_builder]
        pypi_name = wipac-mock-package
        python_min = 3.6

        [options]
        install_requires =
            requests
            typing_extensions

        <your other sections for non-wipac-dev-py-setup-action reasons>
        ```
2. Run as GitHub Action
3. You get:
    - `setup.cfg` with all the original sections *plus*:
        ```
        [metadata]  # generated by wipac:cicd_setup_builder: name, version, url, author, author_email, description, long_description, long_description_content_type, keywords, license, classifiers, download_url, project_urls
        name = wipac-mock-package
        version = attr: mock_package.__version__
        url = https://github.com/foobarbaz-org/foobarbaz-repo
        author = WIPAC Developers
        author_email = developers@icecube.wisc.edu
        description = Ceci nâ€™est pas une pipe
        long_description = file: README.md
        long_description_content_type = text/markdown
        keywords =
            WIPAC
            IceCube
        license = MIT
        classifiers =
            Development Status :: 5 - Production/Stable
            License :: OSI Approved :: MIT License
            Programming Language :: Python :: 3.6
            Programming Language :: Python :: 3.7
            Programming Language :: Python :: 3.8
            Programming Language :: Python :: 3.9
            Programming Language :: Python :: 3.10
        download_url = https://pypi.org/project/wipac-mock-package/
        project_urls =
            Tracker = https://github.com/foobarbaz-org/foobarbaz-repo/issues
            Source = https://github.com/foobarbaz-org/foobarbaz-repo

        [semantic_release]  # fully-generated by wipac:cicd_setup_builder
        version_variable = mock_package/__init__.py:__version__
        upload_to_pypi = True
        patch_without_tag = True
        commit_parser = semantic_release.history.tag_parser
        minor_tag = [minor]
        fix_tag = [fix]
        branch = main

        [options]  # generated by wipac:cicd_setup_builder: python_requires, packages
        install_requires =
            requests
            typing_extensions
        python_requires = >=3.6, <3.11
        packages = find:

        [options.package_data]  # generated by wipac:cicd_setup_builder: '*'
        * = py.typed

        [options.packages.find]  # generated by wipac:cicd_setup_builder: include/exclude
        exclude =
            test
            tests
            doc
            docs
            resource
            resources
        ```
    - `README.md` with badges:
        [![CircleCI](https://img.shields.io/circleci/build/github/WIPACrepo/wipac-dev-tools)](https://app.circleci.com/pipelines/github/WIPACrepo/wipac-dev-tools?branch=main&filter=all) [![PyPI](https://img.shields.io/pypi/v/wipac-dev-tools)](https://pypi.org/project/wipac-dev-tools/) [![GitHub release (latest by date including pre-releases)](https://img.shields.io/github/v/release/WIPACrepo/wipac-dev-tools?include_prereleases)](https://github.com/WIPACrepo/wipac-dev-tools/) [![PyPI - License](https://img.shields.io/pypi/l/wipac-dev-tools)](https://github.com/WIPACrepo/wipac-dev-tools/blob/main/LICENSE) [![Lines of code](https://img.shields.io/tokei/lines/github/WIPACrepo/wipac-dev-tools)](https://github.com/WIPACrepo/wipac-dev-tools/) [![GitHub issues](https://img.shields.io/github/issues/WIPACrepo/wipac-dev-tools)](https://github.com/WIPACrepo/wipac-dev-tools/issues?q=is%3Aissue+sort%3Aupdated-desc+is%3Aopen) [![GitHub pull requests](https://img.shields.io/github/issues-pr/WIPACrepo/wipac-dev-tools)](https://github.com/WIPACrepo/wipac-dev-tools/pulls?q=is%3Apr+sort%3Aupdated-desc+is%3Aopen)
    - `requirements.txt` generated from `[options].install_requires` in `setup.cfg`:
        ```
        #
        # This file is autogenerated by pip-compile with python 3.8
        # To update, run:
        #
        #    pip-compile
        #
        certifi==2021.10.8
            # via requests
        charset-normalizer==2.0.12
            # via requests
        idna==3.3
            # via requests
        requests==2.27.1
            # via wipac-dev-tools (setup.py)
        typing-extensions==4.2.0
            # via wipac-dev-tools (setup.py)
        urllib3==1.26.9
            # via requests
        ```


### Minimal (No PyPI Metadata)
This will generate the absolute minimal sections needed for making a release for your Python package.

1. You define:
    - `setup.cfg` with the `[wipac:cicd_setup_builder]` section and `[options].install_requires` list, like:
        ```
        [wipac:cicd_setup_builder]
        python_min = 3.6

        [options]
        install_requires =
            requests
            typing_extensions

        <your other sections for non-wipac-dev-py-setup-action reasons>
        ```
2. Run as GitHub Action
3. You get:
    - `setup.cfg` with all the original sections *plus*:
        ```
        [metadata]  # generated by wipac:cicd_setup_builder: version
        version = attr: my_pkg.__version__

        [semantic_release]  # fully-generated by wipac:cicd_setup_builder
        version_variable = mock_package/__init__.py:__version__
        upload_to_pypi = False
        patch_without_tag = True
        commit_parser = semantic_release.history.tag_parser
        minor_tag = [minor]
        fix_tag = [fix]
        branch = main

        [options]  # generated by wipac:cicd_setup_builder: python_requires, packages
        install_requires =
            requests
            typing_extensions
        python_requires = >=3.6, <3.11
        packages = find:

        [options.package_data]  # generated by wipac:cicd_setup_builder: '*'
        * = py.typed

        [options.packages.find]  # generated by wipac:cicd_setup_builder: include/exclude
        exclude =
            test
            tests
            doc
            docs
            resource
            resources

        <your other sections for non-wipac-dev-py-setup-action reasons>
        ```
    - `README.md` with badges:
        [![CircleCI](https://img.shields.io/circleci/build/github/WIPACrepo/wipac-dev-tools)](https://app.circleci.com/pipelines/github/WIPACrepo/wipac-dev-tools?branch=main&filter=all) [![GitHub release (latest by date including pre-releases)](https://img.shields.io/github/v/release/WIPACrepo/wipac-dev-tools?include_prereleases)](https://github.com/WIPACrepo/wipac-dev-tools/) [![Lines of code](https://img.shields.io/tokei/lines/github/WIPACrepo/wipac-dev-tools)](https://github.com/WIPACrepo/wipac-dev-tools/) [![GitHub issues](https://img.shields.io/github/issues/WIPACrepo/wipac-dev-tools)](https://github.com/WIPACrepo/wipac-dev-tools/issues?q=is%3Aissue+sort%3Aupdated-desc+is%3Aopen) [![GitHub pull requests](https://img.shields.io/github/issues-pr/WIPACrepo/wipac-dev-tools)](https://github.com/WIPACrepo/wipac-dev-tools/pulls?q=is%3Apr+sort%3Aupdated-desc+is%3Aopen)
    - `requirements.txt` generated from `[options].install_requires` in `setup.cfg`:
        ```
        #
        # This file is autogenerated by pip-compile with python 3.8
        # To update, run:
        #
        #    pip-compile
        #
        certifi==2021.10.8
            # via requests
        charset-normalizer==2.0.12
            # via requests
        idna==3.3
            # via requests
        requests==2.27.1
            # via wipac-dev-tools (setup.py)
        typing-extensions==4.2.0
            # via wipac-dev-tools (setup.py)
        urllib3==1.26.9
            # via requests
        ```





## Advanced Usage Options


## Steps to Use

1. Update setup.cfg with `[wipac:cicd_setup_builder]` section:
    ```
     [wipac:cicd_setup_builder]
     pypi_name = wipac-dev-tools
     python_min = 3.6
     keywords_spaced = python tools utilities
    ```

   Required:
   * pypi_name - PyPI package name
   * python_min - minimum Python version

   Optional:
   * package_dirs - space-separated list of directories to package (else, uses auto-detection)
   * python_max - maximum Python version
   * keywords_spaced - space-separated keyword list

   Python package dependencies go in [options] section:
    ```
     [options]
     install_requires =
        package-a
        package-b
    ```
2. Use as a step in a GitHub Action:
    ```
      py-setup:
        runs-on: ubuntu-latest
        steps:
          - name: checkout
            uses: actions/checkout@v3
            with:
              token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          - uses: WIPACrepo/wipac-dev-py-setup-action@v1.#
    ```
